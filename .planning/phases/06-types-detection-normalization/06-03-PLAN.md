---
phase: 06-types-detection-normalization
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - packages/x402lint/src/registries/networks.ts
  - packages/x402lint/src/registries/assets.ts
  - packages/x402lint/src/registries/simple-names.ts
  - packages/x402lint/src/registries/index.ts
  - packages/x402lint/src/index.ts
autonomous: true

must_haves:
  truths:
    - "The network registry maps CAIP-2 identifiers to known chains with name, type, and testnet flag"
    - "The asset registry maps known asset addresses per network"
    - "Unknown-but-valid CAIP-2 networks can be detected as valid format but unknown registry entry"
    - "Simple chain names (base, solana) map to their CAIP-2 equivalents for legacy fix suggestions"
    - "Registries are extensible -- adding a new chain is adding a record entry, not changing logic"
  artifacts:
    - path: "packages/x402lint/src/registries/networks.ts"
      provides: "KNOWN_NETWORKS record, CAIP2_REGEX, NetworkInfo type, isValidCaip2, isKnownNetwork, getNetworkInfo"
      contains: "eip155:8453"
    - path: "packages/x402lint/src/registries/assets.ts"
      provides: "KNOWN_ASSETS record, AssetInfo type, isKnownAsset, getAssetInfo"
      contains: "USDC"
    - path: "packages/x402lint/src/registries/simple-names.ts"
      provides: "SIMPLE_NAME_TO_CAIP2 mapping, getCanonicalNetwork"
      contains: "base.*eip155:8453"
    - path: "packages/x402lint/src/registries/index.ts"
      provides: "Re-exports of all registry modules"
  key_links:
    - from: "packages/x402lint/src/registries/simple-names.ts"
      to: "packages/x402lint/src/registries/networks.ts"
      via: "maps simple names to CAIP-2 IDs in KNOWN_NETWORKS"
      pattern: "KNOWN_NETWORKS|eip155"
    - from: "packages/x402lint/src/registries/assets.ts"
      to: "packages/x402lint/src/registries/networks.ts"
      via: "assets keyed by CAIP-2 network IDs from KNOWN_NETWORKS"
      pattern: "eip155:8453|solana:5eykt4"
    - from: "packages/x402lint/src/index.ts"
      to: "packages/x402lint/src/registries/index.ts"
      via: "re-export"
      pattern: "export.*from.*registries"
---

<objective>
Create the network, asset, and simple-name registries that downstream modules use for CAIP-2 validation, asset lookup, and legacy format fix suggestions.

Purpose: The registries provide the data layer for network validation (REG-01 through REG-06). Detection and normalization need the simple-name mapping to convert legacy chain names. Validation needs the network and asset registries to distinguish errors from warnings.

Output: Three registry data modules (networks, assets, simple-names) with lookup functions, plus barrel export and updated package entry point.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-types-detection-normalization/06-RESEARCH.md

@packages/x402lint/src/index.ts
@packages/x402lint/src/types/config.ts
@packages/x402lint/src/types/errors.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Network registry and CAIP-2 validation</name>
  <files>
    packages/x402lint/src/registries/networks.ts
    packages/x402lint/src/registries/simple-names.ts
  </files>
  <action>
Create a `src/registries/` directory (remove `.gitkeep` files from any parent dirs if present -- there is no registries dir yet, so just create it).

**networks.ts** -- CAIP-2 network registry (REG-01, REG-02):

1. Define `NetworkType` type: `'evm' | 'solana' | 'stellar' | 'aptos'`

2. Define `NetworkInfo` interface:
   - `name: string` (human-readable, e.g., "Base")
   - `type: NetworkType`
   - `testnet: boolean`

3. `CAIP2_REGEX` -- exported const regex for CAIP-2 format validation:
   `/^[-a-z0-9]{3,8}:[-_a-zA-Z0-9]{1,32}$/`

4. `KNOWN_NETWORKS` -- exported `as const satisfies Record<string, NetworkInfo>` object:

   EVM networks:
   - `'eip155:8453'`: Base, evm, testnet: false
   - `'eip155:84532'`: Base Sepolia, evm, testnet: true
   - `'eip155:43114'`: Avalanche C-Chain, evm, testnet: false
   - `'eip155:43113'`: Avalanche Fuji, evm, testnet: true

   Solana networks:
   - `'solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp'`: Solana Mainnet, solana, testnet: false
   - `'solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1'`: Solana Devnet, solana, testnet: true
   - `'solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z'`: Solana Testnet, solana, testnet: true

   Stellar networks:
   - `'stellar:pubnet'`: Stellar Mainnet, stellar, testnet: false
   - `'stellar:testnet'`: Stellar Testnet, stellar, testnet: true

   Aptos networks (LOW confidence -- no official CAIP namespace, use community convention):
   - `'aptos:1'`: Aptos Mainnet, aptos, testnet: false
   - `'aptos:2'`: Aptos Testnet, aptos, testnet: true

5. Helper functions:
   - `isValidCaip2(value: string): boolean` -- tests against CAIP2_REGEX
   - `isKnownNetwork(caip2: string): boolean` -- checks if key exists in KNOWN_NETWORKS
   - `getNetworkInfo(caip2: string): NetworkInfo | undefined` -- looks up in KNOWN_NETWORKS
   - `getNetworkNamespace(caip2: string): string | undefined` -- extracts namespace part before `:` (e.g., "eip155" from "eip155:8453"). Returns undefined if not valid CAIP-2.

**simple-names.ts** -- Legacy chain name mapping (REG-03):

1. `SIMPLE_NAME_TO_CAIP2` -- exported `as const satisfies Record<string, string>` mapping lowercase simple names to CAIP-2:
   - `'base'` -> `'eip155:8453'`
   - `'base-sepolia'` -> `'eip155:84532'`
   - `'base_sepolia'` -> `'eip155:84532'`
   - `'avalanche'` -> `'eip155:43114'`
   - `'avalanche-fuji'` -> `'eip155:43113'`
   - `'solana'` -> `'solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp'`
   - `'solana-devnet'` -> `'solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1'`
   - `'solana-testnet'` -> `'solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z'`
   - `'stellar'` -> `'stellar:pubnet'`
   - `'stellar-testnet'` -> `'stellar:testnet'`
   - `'aptos'` -> `'aptos:1'`

2. `getCanonicalNetwork(name: string): string | undefined` -- looks up `name.toLowerCase()` in SIMPLE_NAME_TO_CAIP2. Returns the CAIP-2 string if found, undefined if not. This is used by normalization (flat-legacy -> v2) and by fix suggestions ("Use 'eip155:8453' instead of 'base'").

All exports named (no default).
  </action>
  <verify>
Run `cd /Users/rawgroundbeef/Projects/x402lint && pnpm --filter x402lint run typecheck` -- must pass.

Verify KNOWN_NETWORKS has 11 entries (4 EVM + 3 Solana + 2 Stellar + 2 Aptos).
Verify SIMPLE_NAME_TO_CAIP2 has 11 entries mapping simple names to CAIP-2.
  </verify>
  <done>
KNOWN_NETWORKS contains all specified chains with CAIP-2 IDs, types, and testnet flags. CAIP2_REGEX validates format. Simple name mapping covers all known chains. Helper functions (isValidCaip2, isKnownNetwork, getNetworkInfo, getCanonicalNetwork) are exported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Asset registry, barrel exports, and tests</name>
  <files>
    packages/x402lint/src/registries/assets.ts
    packages/x402lint/src/registries/index.ts
    packages/x402lint/src/index.ts
    packages/x402lint/test/registries.test.ts
  </files>
  <action>
**assets.ts** -- Known asset registry (REG-04, REG-05):

1. Define `AssetInfo` interface:
   - `symbol: string` (e.g., "USDC")
   - `name: string` (e.g., "USD Coin")
   - `decimals: number` (e.g., 6)

2. `KNOWN_ASSETS` -- exported `as const satisfies Record<string, Record<string, AssetInfo>>` object. Outer key is CAIP-2 network, inner key is asset address (lowercase for EVM, original case for Solana):

   Base (eip155:8453):
   - `'0x833589fcd6edb6e08f4c7c32d4f71b54bda02913'`: USDC, "USD Coin", 6

   Base Sepolia (eip155:84532):
   - `'0x036cbd53842c5426634e7929541ec2318f3dcf7e'`: USDC, "USD Coin", 6

   Avalanche (eip155:43114):
   - `'0xb97ef9ef8734c71904d8002f8b6bc66dd9c48a6e'`: USDC, "USD Coin", 6

   Solana Mainnet (solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp):
   - `'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v'`: USDC, "USD Coin", 6

   Note: Store EVM addresses in lowercase for case-insensitive lookup. Look up with `address.toLowerCase()`.

3. Helper functions:
   - `isKnownAsset(network: string, address: string): boolean` -- checks if network exists in KNOWN_ASSETS and address (lowercased for EVM networks) exists in that network's record
   - `getAssetInfo(network: string, address: string): AssetInfo | undefined` -- looks up asset, uses lowercase for EVM comparison

**registries/index.ts** -- Barrel re-export:
- `export * from './networks'`
- `export * from './assets'`
- `export * from './simple-names'`

**src/index.ts** -- Add registry re-export:
- Add `export * from './registries'` (uncomment or add new line)
- Keep existing `export * from './types'` and `export const VERSION`

**test/registries.test.ts** -- Registry tests:

```typescript
import { describe, it, expect } from 'vitest'
import {
  KNOWN_NETWORKS,
  KNOWN_ASSETS,
  SIMPLE_NAME_TO_CAIP2,
  CAIP2_REGEX,
  isValidCaip2,
  isKnownNetwork,
  getNetworkInfo,
  getNetworkNamespace,
  getCanonicalNetwork,
  isKnownAsset,
  getAssetInfo,
} from '../src/index'

describe('CAIP-2 validation', () => {
  it('validates correct CAIP-2 format', () => {
    expect(isValidCaip2('eip155:8453')).toBe(true)
    expect(isValidCaip2('solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp')).toBe(true)
    expect(isValidCaip2('stellar:pubnet')).toBe(true)
    expect(isValidCaip2('aptos:1')).toBe(true)
  })

  it('rejects invalid CAIP-2 format', () => {
    expect(isValidCaip2('base')).toBe(false)           // no colon
    expect(isValidCaip2('')).toBe(false)                // empty
    expect(isValidCaip2('a:b')).toBe(false)             // namespace too short
    expect(isValidCaip2('UPPERCASE:123')).toBe(false)   // namespace must be lowercase
    expect(isValidCaip2('eip155:')).toBe(false)          // missing reference
  })
})

describe('network registry', () => {
  it('contains all specified networks', () => {
    expect(isKnownNetwork('eip155:8453')).toBe(true)       // Base
    expect(isKnownNetwork('eip155:84532')).toBe(true)      // Base Sepolia
    expect(isKnownNetwork('eip155:43114')).toBe(true)      // Avalanche
    expect(isKnownNetwork('eip155:43113')).toBe(true)      // Avalanche Fuji
    expect(isKnownNetwork('solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp')).toBe(true)
    expect(isKnownNetwork('stellar:pubnet')).toBe(true)
  })

  it('returns correct network info', () => {
    const base = getNetworkInfo('eip155:8453')
    expect(base).toBeDefined()
    expect(base!.name).toBe('Base')
    expect(base!.type).toBe('evm')
    expect(base!.testnet).toBe(false)
  })

  it('returns undefined for unknown networks', () => {
    expect(getNetworkInfo('eip155:999999')).toBeUndefined()
  })

  it('extracts namespace from CAIP-2', () => {
    expect(getNetworkNamespace('eip155:8453')).toBe('eip155')
    expect(getNetworkNamespace('solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp')).toBe('solana')
    expect(getNetworkNamespace('not-valid')).toBeUndefined()
  })
})

describe('simple name mapping', () => {
  it('maps simple names to CAIP-2', () => {
    expect(getCanonicalNetwork('base')).toBe('eip155:8453')
    expect(getCanonicalNetwork('solana')).toBe('solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp')
    expect(getCanonicalNetwork('stellar')).toBe('stellar:pubnet')
  })

  it('is case-insensitive', () => {
    expect(getCanonicalNetwork('Base')).toBe('eip155:8453')
    expect(getCanonicalNetwork('BASE')).toBe('eip155:8453')
  })

  it('returns undefined for unknown names', () => {
    expect(getCanonicalNetwork('ethereum')).toBeUndefined()
    expect(getCanonicalNetwork('polygon')).toBeUndefined()
  })
})

describe('asset registry', () => {
  it('finds USDC on Base', () => {
    const usdc = getAssetInfo('eip155:8453', '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913')
    expect(usdc).toBeDefined()
    expect(usdc!.symbol).toBe('USDC')
    expect(usdc!.decimals).toBe(6)
  })

  it('finds USDC on Solana', () => {
    expect(isKnownAsset('solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp', 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v')).toBe(true)
  })

  it('returns undefined for unknown assets', () => {
    expect(getAssetInfo('eip155:8453', '0x0000000000000000000000000000000000000000')).toBeUndefined()
  })

  it('returns undefined for unknown network', () => {
    expect(getAssetInfo('eip155:999999', '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913')).toBeUndefined()
  })
})
```

Note on EVM asset lookup: the test passes a mixed-case address for Base USDC (`0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913`) while the registry stores it lowercase. The `getAssetInfo` function must lowercase the input address before lookup when the network namespace is `eip155`. Use `getNetworkNamespace` for this.
  </action>
  <verify>
Run `cd /Users/rawgroundbeef/Projects/x402lint && pnpm --filter x402lint run typecheck` -- must pass.
Run `cd /Users/rawgroundbeef/Projects/x402lint && pnpm --filter x402lint run test` -- all tests pass including registries.test.ts.
  </verify>
  <done>
Asset registry covers USDC on Base, Base Sepolia, Avalanche, and Solana mainnet. Barrel exports wire registries into package. All lookup functions work with case-insensitive EVM address comparison. Tests verify all registry data and lookup functions. REG-01 through REG-06 requirements addressed.
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter x402lint run typecheck` passes
2. `pnpm --filter x402lint run test` passes -- all tests including registries.test.ts
3. KNOWN_NETWORKS has 11 entries (Base, Base Sepolia, Avalanche, Avalanche Fuji, Solana x3, Stellar x2, Aptos x2)
4. KNOWN_ASSETS has USDC entries for 4 networks
5. Simple name -> CAIP-2 mapping works for all known chains
6. isValidCaip2 accepts valid CAIP-2 and rejects garbage
7. Unknown-but-valid CAIP-2 returns false from isKnownNetwork but true from isValidCaip2 (warning not error)
</verification>

<success_criteria>
- REG-01: Known CAIP-2 network registry with Base, Base Sepolia, Avalanche, Avalanche Fuji, Solana (3), Stellar (2), Aptos (2)
- REG-02: isValidCaip2 validates format; isKnownNetwork checks registry; unknown but valid = warning path
- REG-03: SIMPLE_NAME_TO_CAIP2 maps legacy names to CAIP-2 for fix suggestions
- REG-04: KNOWN_ASSETS maps USDC addresses per network
- REG-05: Unknown assets produce undefined from getAssetInfo (callers emit warning, not error)
- REG-06: Extensible -- adding a chain is adding a record entry to KNOWN_NETWORKS
</success_criteria>

<output>
After completion, create `.planning/phases/06-types-detection-normalization/06-03-SUMMARY.md`
</output>
