---
phase: 05-repository-restructuring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pnpm-workspace.yaml
  - package.json
  - .npmrc
  - .gitignore
  - apps/website/package.json
  - apps/website/index.html
  - apps/website/input.js
  - apps/website/validator.js
  - apps/website/chains.js
  - apps/website/test-validator.html
  - apps/website/test-verify.html
  - apps/website/verify-all.html
  - apps/website/worker/proxy.js
  - apps/website/worker/wrangler.toml
  - apps/website/worker/.wrangler/
  - packages/config/package.json
  - packages/config/typescript/base.json
  - packages/x402lint/package.json
  - packages/x402lint/tsconfig.json
  - packages/x402lint/vitest.config.ts
  - packages/x402lint/tsdown.config.ts
  - packages/x402lint/src/index.ts
  - packages/x402lint/src/types/.gitkeep
  - packages/x402lint/src/detection/.gitkeep
  - packages/x402lint/src/validation/.gitkeep
  - packages/x402lint/src/crypto/.gitkeep
  - packages/x402lint/test/index.test.ts
autonomous: true

must_haves:
  truths:
    - "Running pnpm install at repo root installs workspace dependencies for both root and packages/x402lint/"
    - "The existing website (index.html) still loads and functions correctly after restructuring"
    - "packages/x402lint/src/index.ts exists and compiles with tsc --noEmit"
    - "pnpm --filter x402lint test runs vitest and the smoke test passes"
  artifacts:
    - path: "pnpm-workspace.yaml"
      provides: "Workspace definition"
      contains: "packages"
    - path: "package.json"
      provides: "Root package with proxy scripts"
      contains: "build:sdk"
    - path: "apps/website/package.json"
      provides: "Website workspace member"
      contains: "private"
    - path: "packages/config/typescript/base.json"
      provides: "Shared TypeScript base config"
      contains: "noUncheckedIndexedAccess"
    - path: "packages/x402lint/package.json"
      provides: "SDK package manifest"
      contains: "x402lint"
    - path: "packages/x402lint/tsconfig.json"
      provides: "SDK TypeScript config extending shared base"
      contains: "extends"
    - path: "packages/x402lint/src/index.ts"
      provides: "SDK barrel export entry point"
      exports: ["__SDK_VERSION__"]
    - path: "packages/x402lint/test/index.test.ts"
      provides: "SDK smoke test"
      contains: "describe"
    - path: "packages/x402lint/vitest.config.ts"
      provides: "Test runner configuration"
      contains: "defineConfig"
  key_links:
    - from: "packages/x402lint/tsconfig.json"
      to: "packages/config/typescript/base.json"
      via: "extends field"
      pattern: "extends.*config/typescript/base"
    - from: "package.json"
      to: "packages/x402lint"
      via: "pnpm --filter proxy scripts"
      pattern: "pnpm --filter x402lint"
    - from: "pnpm-workspace.yaml"
      to: "apps/*, packages/*"
      via: "workspace packages list"
      pattern: "apps/\\*|packages/\\*"
---

<objective>
Restructure the repository into a pnpm workspace monorepo with three workspace members: the existing website (moved to apps/website/), the SDK package skeleton (packages/x402lint/), and a shared config package (packages/config/). The existing website must still load and function correctly after the move.

Purpose: Give the SDK code a home so all subsequent phases (6-10) have a place to land, without breaking the live website.
Output: Working pnpm monorepo with SDK skeleton that compiles and passes a smoke test.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-repository-restructuring/05-CONTEXT.md
@.planning/phases/05-repository-restructuring/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create monorepo scaffold and move website</name>
  <files>
    pnpm-workspace.yaml
    package.json
    .npmrc
    .gitignore
    apps/website/package.json
    apps/website/index.html
    apps/website/input.js
    apps/website/validator.js
    apps/website/chains.js
    apps/website/test-validator.html
    apps/website/test-verify.html
    apps/website/verify-all.html
    apps/website/worker/proxy.js
    apps/website/worker/wrangler.toml
    apps/website/worker/.wrangler/
  </files>
  <action>
    1. Create `pnpm-workspace.yaml` at repo root:
       ```yaml
       packages:
         - '.'
         - 'apps/*'
         - 'packages/*'
       ```
       CRITICAL: Include `'.'` (root) for Cloudflare Pages compatibility (see RESEARCH.md Pitfall 1).

    2. Create root `package.json`:
       ```json
       {
         "name": "x402lint-monorepo",
         "version": "0.0.0",
         "private": true,
         "scripts": {
           "build:sdk": "pnpm --filter x402lint build",
           "test:sdk": "pnpm --filter x402lint test",
           "lint:sdk": "pnpm --filter x402lint lint"
         }
       }
       ```

    3. Create `.npmrc` at repo root to enforce pnpm strictness:
       ```
       shamefully-hoist=false
       strict-peer-dependencies=true
       ```

    4. Create directories: `apps/website/`, `apps/website/worker/`

    5. Move ALL website files (preserving exact content, no modifications):
       - `index.html` -> `apps/website/index.html`
       - `input.js` -> `apps/website/input.js`
       - `validator.js` -> `apps/website/validator.js`
       - `chains.js` -> `apps/website/chains.js`
       - `test-validator.html` -> `apps/website/test-validator.html`
       - `test-verify.html` -> `apps/website/test-verify.html`
       - `verify-all.html` -> `apps/website/verify-all.html`
       - `worker/proxy.js` -> `apps/website/worker/proxy.js`
       - `worker/wrangler.toml` -> `apps/website/worker/wrangler.toml`
       - `worker/.wrangler/` -> `apps/website/worker/.wrangler/` (entire directory)
       Use `git mv` for each file so git tracks the rename.
       After moving, remove the now-empty `worker/` directory from root.

    6. Create `apps/website/package.json`:
       ```json
       {
         "name": "@x402lint/website",
         "version": "0.0.0",
         "private": true,
         "description": "x402lint validation website"
       }
       ```

    7. Update `.gitignore` -- add entries for monorepo:
       ```
       # Claude Code
       .claude/

       # Wrangler
       .wrangler/

       # Test files
       test-*.html
       verify-*.html

       # OS
       .DS_Store

       # Node
       node_modules/

       # Build outputs
       dist/

       # pnpm
       .pnpm-debug.log
       ```
       The `.wrangler/` pattern is already generic (no path prefix) so it will match in subdirectories too.

    8. Run `pnpm install` at repo root to initialize the workspace lockfile.
  </action>
  <verify>
    - `pnpm install` succeeds without errors at repo root
    - `ls apps/website/index.html` confirms website files moved
    - `ls apps/website/worker/proxy.js` confirms worker files moved
    - Root directory no longer has `index.html`, `validator.js`, `chains.js`, `input.js`, or `worker/` directory
    - `cat pnpm-workspace.yaml` shows correct workspace config
    - `git status` shows renames (not deletes + adds)
  </verify>
  <done>
    Monorepo scaffold exists with pnpm-workspace.yaml, root package.json, and all website files moved to apps/website/ with git history preserved via git mv.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shared config and SDK package skeleton</name>
  <files>
    packages/config/package.json
    packages/config/typescript/base.json
    packages/x402lint/package.json
    packages/x402lint/tsconfig.json
    packages/x402lint/vitest.config.ts
    packages/x402lint/tsdown.config.ts
    packages/x402lint/src/index.ts
    packages/x402lint/src/types/.gitkeep
    packages/x402lint/src/detection/.gitkeep
    packages/x402lint/src/validation/.gitkeep
    packages/x402lint/src/crypto/.gitkeep
    packages/x402lint/test/index.test.ts
  </files>
  <action>
    1. Create `packages/config/package.json`:
       ```json
       {
         "name": "@x402lint/config",
         "version": "1.0.0",
         "private": true,
         "description": "Shared configuration for x402lint monorepo",
         "files": ["typescript"]
       }
       ```

    2. Create `packages/config/typescript/base.json`:
       ```json
       {
         "$schema": "https://json.schemastore.org/tsconfig",
         "compilerOptions": {
           "strict": true,
           "noUncheckedIndexedAccess": true,
           "exactOptionalPropertyTypes": true,
           "esModuleInterop": true,
           "skipLibCheck": true,
           "forceConsistentCasingInFileNames": true,
           "module": "ESNext",
           "moduleResolution": "bundler",
           "target": "ES2022",
           "lib": ["ES2022"],
           "resolveJsonModule": true,
           "isolatedModules": true,
           "declaration": true,
           "declarationMap": true,
           "sourceMap": true
         }
       }
       ```
       IMPORTANT: `noUncheckedIndexedAccess` and `exactOptionalPropertyTypes` are NOT included in `strict: true` -- they must be explicit (RESEARCH.md Pitfall 2).

    3. Create `packages/x402lint/package.json`:
       ```json
       {
         "name": "x402lint",
         "version": "0.0.1",
         "description": "Validate x402 payment configurations",
         "type": "module",
         "main": "./dist/index.cjs",
         "module": "./dist/index.js",
         "types": "./dist/index.d.ts",
         "exports": {
           ".": {
             "types": "./dist/index.d.ts",
             "import": "./dist/index.js",
             "require": "./dist/index.cjs"
           }
         },
         "scripts": {
           "build": "tsdown",
           "test": "vitest run",
           "test:watch": "vitest",
           "lint": "tsc --noEmit",
           "typecheck": "tsc --noEmit"
         },
         "keywords": ["x402", "payment", "validation"],
         "license": "MIT",
         "devDependencies": {}
       }
       ```
       Note: devDependencies will be populated by pnpm add commands below.

    4. Create `packages/x402lint/tsconfig.json`:
       ```json
       {
         "extends": "../config/typescript/base.json",
         "compilerOptions": {
           "outDir": "./dist",
           "rootDir": "./src"
         },
         "include": ["src/**/*"],
         "exclude": ["node_modules", "dist", "test"]
       }
       ```
       Uses relative path for extends (not package name) -- see RESEARCH.md Pitfall 5.

    5. Create `packages/x402lint/vitest.config.ts`:
       ```typescript
       import { defineConfig } from 'vitest/config'

       export default defineConfig({
         test: {
           globals: true,
           environment: 'node',
         }
       })
       ```

    6. Create `packages/x402lint/tsdown.config.ts`:
       ```typescript
       import { defineConfig } from 'tsdown'

       export default defineConfig({
         entry: ['./src/index.ts'],
         format: ['esm', 'cjs'],
         dts: true,
         clean: true,
       })
       ```

    7. Create directory structure for future phase code:
       - `packages/x402lint/src/types/` (Phase 6)
       - `packages/x402lint/src/detection/` (Phase 6)
       - `packages/x402lint/src/validation/` (Phase 8)
       - `packages/x402lint/src/crypto/` (Phase 7)
       Add `.gitkeep` in each empty directory so git tracks them.

    8. Create `packages/x402lint/src/index.ts`:
       ```typescript
       // x402lint SDK - entry point
       // Named exports only (no default) for IIFE compatibility

       // Re-export types when available (Phase 6)
       // export * from './types'

       // Re-export detection when available (Phase 6)
       // export { detect, normalize } from './detection'

       // Re-export validation when available (Phase 8)
       // export { validate } from './validation'

       // Stub export to satisfy initial compilation
       export const VERSION = '0.0.1' as const
       ```

    9. Create `packages/x402lint/test/index.test.ts`:
       ```typescript
       import { describe, it, expect } from 'vitest'
       import { VERSION } from '../src/index'

       describe('x402lint package', () => {
         it('exports VERSION constant', () => {
           expect(VERSION).toBe('0.0.1')
         })

         it('exports are defined', async () => {
           const mod = await import('../src/index')
           expect(mod).toBeDefined()
           expect(typeof mod).toBe('object')
         })
       })
       ```

    10. Install devDependencies for the SDK package:
        ```bash
        cd packages/x402lint
        pnpm add -D typescript vitest tsdown
        ```
        Then run `pnpm install` from repo root to update the lockfile.

    11. Verify everything works:
        - `pnpm --filter x402lint lint` (tsc --noEmit) should succeed
        - `pnpm --filter x402lint test` (vitest run) should pass
  </action>
  <verify>
    - `pnpm --filter x402lint lint` exits 0 (TypeScript compiles)
    - `pnpm --filter x402lint test` exits 0 (vitest smoke test passes)
    - `cat packages/x402lint/tsconfig.json` shows extends pointing to shared config
    - `ls packages/x402lint/src/types packages/x402lint/src/detection packages/x402lint/src/validation packages/x402lint/src/crypto` confirms all subdirectories exist
    - `cat packages/config/typescript/base.json` includes both `noUncheckedIndexedAccess` and `exactOptionalPropertyTypes`
  </verify>
  <done>
    Shared config package and SDK package skeleton exist. TypeScript compiles with maximum strict settings. Vitest smoke test imports the SDK entry point and passes. All future-phase subdirectories (types, detection, validation, crypto) are created.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify website integrity and workspace health</name>
  <files>
    (no new files -- verification only)
  </files>
  <action>
    1. Run `pnpm install` at repo root -- must succeed with no errors.

    2. Verify workspace members are recognized:
       ```bash
       pnpm ls --depth -1 -r
       ```
       Must show at least: root (x402lint-monorepo), @x402lint/website, @x402lint/config, x402lint.

    3. Verify proxy scripts work:
       - `pnpm run test:sdk` from repo root should pass (delegates to packages/x402lint)
       - `pnpm run lint:sdk` from repo root should pass (delegates to tsc --noEmit)

    4. Verify website files are intact after move:
       - `apps/website/index.html` exists and is not empty
       - `apps/website/validator.js` exists and is not empty
       - `apps/website/chains.js` exists and is not empty
       - `apps/website/input.js` exists and is not empty
       - `apps/website/worker/proxy.js` exists and is not empty
       - `apps/website/worker/wrangler.toml` exists and is not empty
       Files should have identical content to their original locations (git mv preserves content).

    5. Verify no website files remain at root:
       - Root directory should NOT contain: index.html, validator.js, chains.js, input.js, worker/
       - Only root-level items should be: package.json, pnpm-workspace.yaml, pnpm-lock.yaml, .npmrc, .gitignore, .git/, .claude/, .planning/, .wrangler/ (if still exists), apps/, packages/, node_modules/

    6. Verify git status looks clean (renames tracked, no unexpected changes):
       ```bash
       git status
       ```
       Should show renamed files (index.html -> apps/website/index.html, etc.) and new files (SDK skeleton, config files).
  </action>
  <verify>
    - `pnpm ls --depth -1 -r` lists all 4 workspace members
    - `pnpm run test:sdk` from root exits 0
    - `pnpm run lint:sdk` from root exits 0
    - `apps/website/index.html` exists with non-zero size
    - Root `index.html` does NOT exist
    - `git status` shows tracked renames and new files, no unintended deletions
  </verify>
  <done>
    Full workspace health verified: pnpm recognizes all workspace members, proxy scripts delegate correctly, website files are intact in their new location, SDK compiles and tests pass, no files lost during restructuring.
  </done>
</task>

</tasks>

<verification>
Phase 5 success criteria from ROADMAP.md:

1. **pnpm install works**: Running `pnpm install` at the repo root installs workspace dependencies for both root and `packages/x402lint/`
   - Verify: `pnpm install` exits 0, `pnpm ls --depth -1 -r` shows all workspace members

2. **Website still works**: The existing website (index.html) still loads and functions correctly after restructuring
   - Verify: `apps/website/index.html` exists with full content, all JS files present alongside it, `git diff` shows no content changes to website files (only path changes)

3. **SDK compiles**: `packages/x402lint/src/index.ts` exists and compiles with `tsc --noEmit`
   - Verify: `pnpm --filter x402lint lint` exits 0 (runs tsc --noEmit)
</verification>

<success_criteria>
- pnpm workspace with 4 members (root, website, config, x402lint) is functional
- Website files moved to apps/website/ with git history preserved
- SDK package at packages/x402lint/ with TypeScript strict config, vitest, tsdown
- Shared TypeScript base config at packages/config/typescript/base.json with noUncheckedIndexedAccess + exactOptionalPropertyTypes
- `pnpm run test:sdk` passes from repo root
- `pnpm run lint:sdk` passes from repo root
- No website files remain at repo root (all moved to apps/website/)
</success_criteria>

<output>
After completion, create `.planning/phases/05-repository-restructuring/05-01-SUMMARY.md`
</output>
