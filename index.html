<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>x402 Config Validator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            mono: ['JetBrains Mono', 'Fira Code', 'Consolas', 'monospace'],
          }
        }
      }
    }
  </script>
  <style>
    /* Custom styles that Tailwind can't easily do */
    .example-code .key { color: #9cdcfe; }
    .example-code .string { color: #ce9178; }
    .example-code .number { color: #b5cea8; }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-white">
  <div class="max-w-4xl mx-auto px-4 py-12">
    <!-- Header -->
    <div class="text-center mb-10">
      <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent mb-3">
        x402 Config Validator
      </h1>
      <p class="text-slate-400 text-lg">Validate your x402 payment configuration in seconds</p>
    </div>

    <!-- Main Card -->
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 shadow-2xl overflow-hidden">
      <!-- Examples Section -->
      <details class="border-b border-slate-700">
        <summary class="px-6 py-4 cursor-pointer flex justify-between items-center hover:bg-slate-700/30 transition-colors">
          <span class="font-medium text-slate-300">x402 Format Examples</span>
          <svg class="w-5 h-5 text-slate-400 transition-transform details-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </summary>
        <div class="px-6 py-4 bg-slate-800/50">
          <!-- Tabs -->
          <div class="flex gap-2 mb-4">
            <button class="example-tab px-4 py-2 rounded-lg text-sm font-medium transition-all bg-blue-600 text-white" data-version="1">
              v1 (payments)
            </button>
            <button class="example-tab px-4 py-2 rounded-lg text-sm font-medium transition-all bg-slate-700 text-slate-300 hover:bg-slate-600" data-version="2">
              v2 (accepts)
            </button>
          </div>

          <!-- Code examples -->
          <div id="example-v1" class="example-code bg-slate-900 rounded-lg p-4 font-mono text-sm overflow-x-auto whitespace-pre mb-4">{
  <span class="key">"x402Version"</span>: <span class="number">1</span>,
  <span class="key">"payments"</span>: [{
    <span class="key">"chain"</span>: <span class="string">"solana"</span>,
    <span class="key">"address"</span>: <span class="string">"5F5Yy9qJov8xK67vEWRoZHppWHEmH3WuG7mSfvLuqUTz"</span>,
    <span class="key">"asset"</span>: <span class="string">"USDC"</span>,
    <span class="key">"minAmount"</span>: <span class="string">"0.025"</span>
  }]
}</div>

          <div id="example-v2" class="example-code bg-slate-900 rounded-lg p-4 font-mono text-sm overflow-x-auto whitespace-pre mb-4 hidden">{
  <span class="key">"x402Version"</span>: <span class="number">2</span>,
  <span class="key">"accepts"</span>: [{
    <span class="key">"chain"</span>: <span class="string">"solana"</span>,
    <span class="key">"payTo"</span>: <span class="string">"5F5Yy9qJov8xK67vEWRoZHppWHEmH3WuG7mSfvLuqUTz"</span>,
    <span class="key">"asset"</span>: <span class="string">"USDC"</span>,
    <span class="key">"price"</span>: <span class="string">"0.025"</span>
  }]
}</div>

          <!-- Info box -->
          <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 text-sm">
            <p class="font-semibold text-blue-400 mb-2">Your endpoint should:</p>
            <ol class="text-slate-300 space-y-1 list-decimal list-inside">
              <li>Return HTTP status <span class="text-blue-400 font-medium">402 Payment Required</span></li>
              <li>Include config in <span class="text-blue-400 font-medium">PAYMENT-REQUIRED</span> header (base64) or response body</li>
              <li>Supported chains: <span class="text-emerald-400 font-mono text-xs">base</span>, <span class="text-emerald-400 font-mono text-xs">base-sepolia</span>, <span class="text-emerald-400 font-mono text-xs">solana</span>, <span class="text-emerald-400 font-mono text-xs">solana-devnet</span></li>
            </ol>
          </div>

          <button id="load-example-btn" class="mt-4 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-medium transition-colors">
            Load example into validator
          </button>
        </div>
      </details>

      <!-- Input Section -->
      <div class="p-6">
        <textarea
          id="config-input"
          class="w-full h-64 bg-slate-900 border border-slate-600 rounded-xl p-4 font-mono text-sm text-slate-100 placeholder-slate-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none resize-y transition-all"
          placeholder="Paste a URL or x402 JSON config..."></textarea>

        <!-- Controls -->
        <div class="flex items-center gap-4 mt-4">
          <div class="flex items-center gap-2">
            <label class="text-sm text-slate-400">Method:</label>
            <select id="method-select" class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm font-mono focus:border-blue-500 focus:outline-none">
              <option value="GET">GET</option>
              <option value="POST">POST</option>
              <option value="PUT">PUT</option>
              <option value="DELETE">DELETE</option>
              <option value="PATCH">PATCH</option>
            </select>
          </div>
          <button
            id="validate-btn"
            class="flex-1 sm:flex-none px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 rounded-xl font-semibold transition-all shadow-lg shadow-blue-500/25 disabled:opacity-50 disabled:cursor-not-allowed">
            Validate
          </button>
        </div>
      </div>

      <!-- Results Section -->
      <div id="results" class="hidden"></div>
    </div>

    <!-- Footer -->
    <p class="text-center text-slate-500 text-sm mt-8">
      Made by <a href="https://x.com/rawgroundbeef" class="text-blue-400 hover:underline">@rawgroundbeef</a>
    </p>
  </div>

  <!-- CDN Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js" integrity="sha512-QED56W0x3KyGHKqd3XCcXEhk2F8e8s8qYqBa6BoHKWQGe3tuWtE3LXjKaXU0A9TXWz/JmSTdlJlBVPWM8d1aLA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/bs58@6.0.0/dist/index.umd.js" integrity="sha512-A78lV0mETbjmjxh/m5Bq/gu9SNRfVzfX/A4b0kSHEozsz4PYLdPxFQKq7M8FdPPMvwq+9aJjx/xOjXABOvZGCQ==" crossorigin="anonymous"></script>

  <!-- App Scripts -->
  <script src="chains.js"></script>
  <script src="validator.js"></script>
  <script src="input.js"></script>

  <!-- UI Logic -->
  <script>
    const configInput = document.getElementById('config-input');
    const validateBtn = document.getElementById('validate-btn');
    const methodSelect = document.getElementById('method-select');
    const resultsDiv = document.getElementById('results');

    // Example configs
    const examples = {
      1: `{
  "x402Version": 1,
  "payments": [{
    "chain": "solana",
    "address": "5F5Yy9qJov8xK67vEWRoZHppWHEmH3WuG7mSfvLuqUTz",
    "asset": "USDC",
    "minAmount": "0.025"
  }]
}`,
      2: `{
  "x402Version": 2,
  "accepts": [{
    "chain": "solana",
    "payTo": "5F5Yy9qJov8xK67vEWRoZHppWHEmH3WuG7mSfvLuqUTz",
    "asset": "USDC",
    "price": "0.025"
  }]
}`
    };

    let currentExampleVersion = 1;

    // Example tab switching
    document.querySelectorAll('.example-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const version = parseInt(tab.dataset.version);
        currentExampleVersion = version;

        // Update active tab styling
        document.querySelectorAll('.example-tab').forEach(t => {
          t.classList.remove('bg-blue-600', 'text-white');
          t.classList.add('bg-slate-700', 'text-slate-300', 'hover:bg-slate-600');
        });
        tab.classList.remove('bg-slate-700', 'text-slate-300', 'hover:bg-slate-600');
        tab.classList.add('bg-blue-600', 'text-white');

        // Show corresponding example
        document.getElementById('example-v1').classList.toggle('hidden', version !== 1);
        document.getElementById('example-v2').classList.toggle('hidden', version !== 2);
      });
    });

    // Load example button
    document.getElementById('load-example-btn').addEventListener('click', () => {
      configInput.value = examples[currentExampleVersion];
    });

    // Click handler with loading state
    validateBtn.addEventListener('click', async () => {
      const inputValue = configInput.value.trim();
      const method = methodSelect.value;

      if (!inputValue) {
        displayError('No input provided. Please paste a URL or JSON config.');
        return;
      }

      // Disable button, show loading
      validateBtn.disabled = true;
      const originalText = validateBtn.textContent;
      validateBtn.textContent = 'Validating...';

      try {
        await handleValidation(inputValue, method, displayResults, displayError);
      } catch (error) {
        displayError(error.message);
      } finally {
        validateBtn.disabled = false;
        validateBtn.textContent = originalText;
      }
    });

    // Display validation results
    function displayResults(result) {
      let html = '<div class="p-6 border-t border-slate-700">';

      // Request info for URL fetches
      if (result.source && result.source !== 'direct input') {
        html += `
          <div class="font-mono text-sm text-slate-400 mb-3">
            <span class="text-blue-400 font-semibold">${result.method}</span>
            <span class="text-slate-500">${result.url}</span>
            <span class="text-slate-600 mx-2">→</span>
            <span>${result.source}</span>
          </div>`;
      }

      // Status warning for non-402 responses
      if (result.warning) {
        html += `<div class="text-amber-400 text-sm mb-3 flex items-center gap-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
          ${result.warning}
        </div>`;
      }

      // Status badge
      if (result.valid) {
        html += `
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center">
              <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <div>
              <div class="text-xl font-bold text-emerald-400">Valid</div>
              <div class="text-sm text-slate-400">x402 version ${result.version}${result.warnings.length ? ` • ${result.warnings.length} warning${result.warnings.length > 1 ? 's' : ''}` : ''}</div>
            </div>
          </div>`;
      } else {
        html += `
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center">
              <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </div>
            <div>
              <div class="text-xl font-bold text-red-400">Invalid</div>
              <div class="text-sm text-slate-400">${result.errors.length} error${result.errors.length > 1 ? 's' : ''}${result.warnings.length ? ` • ${result.warnings.length} warning${result.warnings.length > 1 ? 's' : ''}` : ''}</div>
            </div>
          </div>`;
      }

      // Show errors
      if (result.errors.length > 0) {
        html += '<div class="space-y-2 mb-4">';
        result.errors.forEach(error => {
          html += `
            <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-3">
              <div class="font-mono text-sm text-red-400 font-semibold">${error.field}</div>
              <div class="text-slate-300 text-sm mt-1">${error.message}</div>
              <div class="text-slate-400 text-sm mt-1 flex items-start gap-1">
                <span class="text-emerald-400">→</span> ${error.fix}
              </div>
            </div>`;
        });
        html += '</div>';
      }

      // Show warnings
      if (result.warnings.length > 0) {
        html += '<div class="space-y-2 mb-4">';
        result.warnings.forEach(warning => {
          html += `
            <div class="bg-amber-500/10 border border-amber-500/30 rounded-lg p-3">
              <div class="font-mono text-sm text-amber-400 font-semibold">${warning.field}</div>
              <div class="text-slate-300 text-sm mt-1">${warning.message}</div>
              <div class="text-slate-400 text-sm mt-1 flex items-start gap-1">
                <span class="text-emerald-400">→</span> ${warning.fix}
              </div>
            </div>`;
        });
        html += '</div>';
      }

      // Raw fetched config
      if (result.fetchedConfig) {
        let formattedConfig;
        try {
          formattedConfig = JSON.stringify(JSON.parse(result.fetchedConfig), null, 2);
        } catch (e) {
          formattedConfig = result.fetchedConfig;
        }
        html += `
          <details class="mt-4">
            <summary class="text-sm text-slate-400 cursor-pointer hover:text-slate-300 transition-colors">
              View fetched response
            </summary>
            <pre class="mt-2 bg-slate-900 rounded-lg p-4 font-mono text-xs text-slate-300 overflow-x-auto max-h-64 overflow-y-auto">${escapeHtml(formattedConfig)}</pre>
          </details>`;
      }

      html += '</div>';
      resultsDiv.innerHTML = html;
      resultsDiv.classList.remove('hidden');
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Display error message
    function displayError(message) {
      resultsDiv.innerHTML = `
        <div class="p-6 border-t border-slate-700">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center">
              <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
              </svg>
            </div>
            <div>
              <div class="text-lg font-bold text-red-400">Error</div>
              <div class="text-sm text-slate-400">${message}</div>
            </div>
          </div>
        </div>`;
      resultsDiv.classList.remove('hidden');
    }
  </script>
</body>
</html>
